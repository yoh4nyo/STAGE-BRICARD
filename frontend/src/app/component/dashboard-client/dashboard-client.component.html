<div class="client-dashboard-page">
  <!-- En-tête (inchangé) -->
  <header class="dashboard-header">
    <span class="header-title">Mes projets</span>
    <span class="header-icon logout-icon" (click)="logout()" title="Déconnexion" role="button" tabindex="0">
      <i class="bi bi-box-arrow-right"></i>
    </span>
  </header>

  <!-- Contenu principal (inchangé) -->
  <main class="dashboard-content">
    <button class="btn create-project-btn" (click)="openModal()">
      CRÉER UN PROJET
    </button>
  </main>
</div>


<!-- === MODALE === -->
<div class="modal-backdrop" *ngIf="isModalOpen" (click)="closeModal()"></div>

<div class="modal-container" *ngIf="isModalOpen">
  <div class="modal-content">
    <h2 class="modal-title">Nouveau projet</h2>

    <form (ngSubmit)="submitProject()" #projectForm="ngForm">
      <div class="form-grid">

        <!-- Champ Nom du projet (inchangé) -->
        <div class="form-group">
          <label for="projectName">Nom du projet</label>
          <input type="text"
                 id="projectName"
                 name="projectName"
                 class="form-control"
                 placeholder="Entrez le nom du projet"
                 [(ngModel)]="newProject.name"
                 required>
          <!-- Optionnel: Ajouter un message d'erreur si le champ est invalide après interaction -->
          <!-- <div *ngIf="projectForm.controls['projectName']?.invalid && (projectForm.controls['projectName']?.dirty || projectForm.controls['projectName']?.touched)">
               <small class="text-danger">Le nom du projet est requis.</small>
             </div> -->
        </div>

        <!-- Champ Type d'organigramme (MODIFIÉ) -->
        <div class="form-group">
          <label for="projectType">Choix du type d'organigramme</label>
          <select id="projectType"
                  name="projectType"
                  class="form-control"
                  [(ngModel)]="newProject.type"
                  required>
            <!-- Option par défaut, valeur vide pour la validation 'required' -->
            <option [ngValue]="null" disabled selected>Sélectionnez un type...</option> <!-- ou [ngValue]="''" -->
            <!-- Boucle sur les types chargés depuis l'API -->
          </select>
           <!-- Optionnel: Message d'erreur -->
          <!-- <div *ngIf="projectForm.controls['projectType']?.invalid && (projectForm.controls['projectType']?.dirty || projectForm.controls['projectType']?.touched)">
               <small class="text-danger">Le type d'organigramme est requis.</small>
           </div> -->
        </div>

        <!-- Champ Date de création (inchangé) -->
        <div class="form-group">
            <label for="creationDate">Date de création</label>
            <div class="date-input-wrapper">
                <input type="date" id="creationDate" name="creationDate" class="form-control" [(ngModel)]="newProject.creationDate" required>
            </div>
             <!-- Optionnel: Message d'erreur -->
            <!-- <div *ngIf="projectForm.controls['creationDate']?.invalid && (projectForm.controls['creationDate']?.dirty || projectForm.controls['creationDate']?.touched)">
                 <small class="text-danger">La date de création est requise.</small>
             </div> -->
        </div>


        <!-- Champ Niveau de sécurité (MODIFIÉ) -->
        <div class="form-group">
          <label for="securityLevel">Choix du niveau de sécurité</label>
          <select id="securityLevel"
                  name="securityLevel"
                  class="form-control"
                  [(ngModel)]="newProject.securityLevel"
                  required>
             <!-- Option par défaut, valeur vide pour la validation 'required' -->
            <option [ngValue]="null" disabled selected>Sélectionnez un niveau...</option> <!-- ou [ngValue]="''" -->
            <!-- Boucle sur les niveaux chargés depuis l'API -->
            <!-- 'level.code' sera la valeur stockée (ex: 'Dual XP S2') -->
            <!-- 'level.label' sera le texte affiché (ex: 'Niveau 4: Dual XP S2') -->
            <option *ngFor="let level of securityLevels" [value]="level.code">
              {{ level.label }}
            </option>
          </select>
           <!-- Optionnel: Message d'erreur -->
          <!-- <div *ngIf="projectForm.controls['securityLevel']?.invalid && (projectForm.controls['securityLevel']?.dirty || projectForm.controls['securityLevel']?.touched)">
               <small class="text-danger">Le niveau de sécurité est requis.</small>
           </div> -->
        </div>

      </div> <!-- Fin form-grid -->

      <!-- Bouton d'envoi (Validation Angular Form) -->
      <div class="form-actions">
        <!-- Le bouton est désactivé si le formulaire n'est pas valide OU si une soumission est en cours -->
        <button type="submit" class="btn submit-project-btn" [disabled]="!projectForm.form.valid || isSubmitting">
           {{ isSubmitting ? 'Création...' : 'Démarrer le projet' }}
        </button>
      </div>

    </form> <!-- Fin du formulaire -->


    <button class="close-modal-btn" (click)="closeModal()" title="Fermer">×</button>

  </div> <!-- Fin modal-content -->
</div> <!-- Fin modal-container -->